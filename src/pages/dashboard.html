<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Friction System | Dashboard</title>
    <link rel="stylesheet" href="../features/dashboard/dashboard.css" />
  </head>
  <body>
    <div class="sidebar">
      <h2>Friction</h2>
      <nav>
        <button class="nav-btn active" data-tab="overview"><span>◈</span> Overview</button>
        <button class="nav-btn" data-tab="detailed-recap"><span>▤</span> Detailed Recap</button>
        <button class="nav-btn" data-tab="blocklist"><span>⊘</span> 차단 관리</button>
        <button class="nav-btn" data-tab="schedule"><span>⊙</span> 스케줄</button>
        <button class="nav-btn" data-tab="settings"><span>⚙</span> 필터 설정</button>
        <button class="nav-btn" data-tab="util"><span>+</span> 유틸</button>
      </nav>
      <div class="sidebar-footer">
        <div class="theme-switch-wrapper">
          <span class="theme-label">🌙 다크 모드</span>
          <label class="switch">
            <input type="checkbox" id="darkModeToggle">
            <span class="slider"></span>
          </label>
        </div>
      </div>
    </div>

    <div class="main-content">
      <section id="overview" class="tab-content active">
        <header>
          <h1>사용 개요</h1>
          <p>오늘의 활동 패턴과 어제 대비 변화를 한눈에 확인하세요.</p>
        </header>

        <div class="overview-carousel" id="overviewCarousel" aria-roledescription="carousel" aria-label="사용 개요 카드">
          <div class="overview-carousel-track" id="overviewCarouselTrack">
            <article class="overview-slide" data-slide-title="오늘 많이 사용" aria-label="오늘 많이 사용">
              <div class="recap-header">
                <h3>🏆 오늘 가장 많이 사용한 사이트 (Top 5)</h3>
                <p class="section-desc">포그라운드(활성 탭) 사용 시간 기준입니다.</p>
              </div>
              <div class="recap-list" id="topUsedList"></div>
            </article>

            <article class="overview-slide" data-slide-title="백그라운드" aria-label="백그라운드">
              <div class="recap-header">
                <h3 style="color: var(--accent);">👻 백그라운드 체류 (Top 5)</h3>
                <p class="section-desc">탭은 열려있지만 활성화되지 않았던 체류 시간입니다.</p>
              </div>
              <div class="recap-list" id="backgroundList"></div>
            </article>

            <article class="overview-slide" data-slide-title="증가" aria-label="증가">
              <div class="recap-header">
                <h3 style="color: var(--color-blocked);">🔥 어제보다 더 많이 사용했어요 (Top 5)</h3>
                <p class="section-desc">포그라운드 기준으로 사용 시간이 늘어난 사이트입니다.</p>
              </div>
              <div class="recap-list" id="increaseList"></div>
            </article>

            <article class="overview-slide" data-slide-title="감소" aria-label="감소">
              <div class="recap-header">
                <h3 style="color: var(--color-safe);">✅ 집중력을 잘 유지하고 있어요 (Top 5)</h3>
                <p class="section-desc">포그라운드 기준으로 사용 시간이 줄어든 사이트입니다.</p>
              </div>
              <div class="recap-list" id="decreaseList"></div>
            </article>
          </div>

          <div class="overview-carousel-controls" aria-label="개요 카드 이동">
            <button type="button" class="carousel-btn" id="overviewPrev" aria-label="이전 카드">‹</button>
            <div class="carousel-dots" id="overviewDots" role="tablist" aria-label="개요 카드 목록"></div>
            <button type="button" class="carousel-btn" id="overviewNext" aria-label="다음 카드">›</button>
          </div>
        </div>
      </section>

      <section id="detailed-recap" class="tab-content">
        <header>
          <h1>상세 리캡</h1>
          <p>일간/주간 사용 시간과 차단 비중을 그래프로 확인해 보세요.</p>
        </header>

        <div class="card" style="padding: 10px 24px">
          <div class="recap-mode-toggle">
            <div class="sort-options">
              <button id="toggleDaily" class="active">일간 분석</button>
              <button id="toggleWeekly">주간 분석</button>
            </div>
            <input type="date" id="dailyDate" class="date-input is-inline" />
          </div>
        </div>

        <div class="detailed-analysis active" id="dailyAnalysis">
          <div class="summary-cards">
            <div class="summary-card">총 사용 시간: <span id="dailyTotal">0초</span></div>
            <div class="summary-card">차단 시간: <span id="dailyBlocked">0초</span></div>
            <div class="summary-card change-card">전일 대비 <span id="dailyChange"></span></div>
          </div>
          <div class="chart-header">
            <div class="chart-legend" aria-label="그래프 범례">
              <span class="legend-item"><span class="legend-swatch swatch-total"></span>사용 시간</span>
              <span class="legend-item"><span class="legend-swatch swatch-blocked"></span>차단(마찰) 시간</span>
            </div>
            <div class="chart-insight" id="dailyInsight"></div>
          </div>
          <div class="graph-container" id="dailyGraph"></div>
          <div class="graph-label">시간 (0h - 23h)</div>

          <div class="reveal-section is-visible" style="margin-top: 16px">
            <div class="recap-header">
              <h3 style="margin: 0">사이트별 누적 사용시간</h3>
              <p class="section-desc">선택한 날짜의 포그라운드 누적시간을 전체 사이트로 표시합니다.</p>
            </div>
            <div class="recap-list" id="dailyAllSitesList"></div>
          </div>
        </div>

        <div class="detailed-analysis" id="weeklyAnalysis">
          <div class="summary-cards">
            <div class="summary-card">총 사용 시간: <span id="weeklyTotal">0초</span></div>
            <div class="summary-card">차단 시간: <span id="weeklyBlocked">0초</span></div>
            <div class="summary-card change-card">전주 대비 <span id="weeklyChange"></span></div>
          </div>
          <div class="chart-header">
            <div class="chart-legend" aria-label="그래프 범례">
              <span class="legend-item"><span class="legend-swatch swatch-total"></span>사용 시간</span>
              <span class="legend-item"><span class="legend-swatch swatch-blocked"></span>차단(마찰) 시간</span>
            </div>
            <div class="chart-insight" id="weeklyInsight"></div>
          </div>
          <div class="graph-container" id="weeklyGraph"></div>
          <div class="graph-label">요일 (일 ~ 토)</div>

          <div class="reveal-section is-visible" style="margin-top: 16px">
            <div class="recap-header">
              <h3 style="margin: 0">사이트별 주간 누적 사용시간</h3>
              <p class="section-desc">최근 7일 포그라운드 누적시간을 전체 사이트로 표시합니다.</p>
            </div>
            <div class="recap-list" id="weeklyAllSitesList"></div>
          </div>
        </div>
      </section>

      <section id="blocklist" class="tab-content">
        <header>
          <h1>차단 관리</h1>
          <p>방해되는 사이트 도메인을 등록하면 마찰 필터가 자동 적용돼요.</p>
        </header>

        <div class="card block-add-panel">
          <input type="text" id="newBlockUrl" placeholder="차단할 도메인 입력 (예: youtube.com)" />
          <button id="addBlockBtn" class="primary-btn">차단 추가</button>
        </div>

        <ul class="block-list" id="blockedListDisplay"></ul>
      </section>

      <section id="schedule" class="tab-content">
        <header>
          <h1>스케줄</h1>
          <p>특정 시간에만 마찰 필터가 작동하도록 설정할 수 있어요.</p>
        </header>

        <div class="card schedule-panel">
          <div class="schedule-toggle-row">
            <div class="schedule-toggle-text">
              <h3>스케줄 기반 필터</h3>
              <p>요일과 시간 블록을 지정하면 선택된 시간에만 마찰 필터가 작동합니다.</p>
            </div>
            <label class="switch">
              <input type="checkbox" id="schedule-toggle" />
              <span class="slider"></span>
            </label>
          </div>
          <div class="schedule-summary" id="schedule-summary"></div>
        </div>

        <div id="schedule-controls">
          <div class="card schedule-days-panel">
            <div class="schedule-panel-header">
              <div>
                <h3 class="schedule-panel-title">활성 요일</h3>
                <p class="schedule-panel-desc">필터가 작동할 요일을 골라주세요.</p>
              </div>
              <div class="schedule-day-actions">
                <button type="button" class="chip chip-subtle" data-day-preset="weekday">주중</button>
                <button type="button" class="chip chip-subtle" data-day-preset="weekend">주말</button>
                <button type="button" class="chip chip-subtle" data-day-preset="all">매일</button>
              </div>
            </div>
            <div class="schedule-days" id="schedule-days">
              <button type="button" class="chip day-chip" data-day="0">일</button>
              <button type="button" class="chip day-chip" data-day="1">월</button>
              <button type="button" class="chip day-chip" data-day="2">화</button>
              <button type="button" class="chip day-chip" data-day="3">수</button>
              <button type="button" class="chip day-chip" data-day="4">목</button>
              <button type="button" class="chip day-chip" data-day="5">금</button>
              <button type="button" class="chip day-chip" data-day="6">토</button>
            </div>
          </div>

          <div class="card time-slider-container" id="time-slider-container">
            <div class="schedule-panel-header">
              <div>
                <h3 class="schedule-panel-title">시간 블록</h3>
                <p class="schedule-panel-desc">여러 개의 블록을 추가하고 선택해서 조정하세요.</p>
              </div>
              <button type="button" class="chip chip-primary" id="add-schedule-block">+ 블록 추가</button>
            </div>

            <div class="schedule-presets">
              <span class="schedule-presets-label">프리셋</span>
              <div class="schedule-presets-row" id="schedule-presets">
                <button type="button" class="chip preset-chip" data-start="540" data-end="720">집중 09:00–12:00</button>
                <button type="button" class="chip preset-chip" data-start="1080" data-end="1320">저녁 18:00–22:00</button>
                <button type="button" class="chip preset-chip" data-start="1380" data-end="420">수면 23:00–07:00</button>
                <button type="button" class="chip preset-chip" data-start="0" data-end="1440">하루 종일</button>
              </div>
              <p class="schedule-presets-help">선택된 블록에 적용됩니다.</p>
            </div>

            <div class="time-display">
              <div class="time-display-main">
                <label class="time-field">
                  <span class="time-field-label">시작</span>
                  <input
                    type="text"
                    id="start-time-input"
                    class="time-field-input"
                    placeholder="00:00"
                    inputmode="numeric"
                    pattern="[0-9]*"
                    maxlength="5"
                    autocomplete="off"
                  />
                </label>
                <span class="separator">~</span>
                <label class="time-field">
                  <span class="time-field-label">종료</span>
                  <input
                    type="text"
                    id="end-time-input"
                    class="time-field-input"
                    placeholder="24:00"
                    inputmode="numeric"
                    pattern="[0-9]*"
                    maxlength="5"
                    autocomplete="off"
                  />
                </label>
              </div>
            </div>

            <div class="slider-track-wrapper">
              <span class="schedule-span-note" id="schedule-span-note"></span>
              <div class="slider-track"></div>
              <div class="slider-ticks"></div>
              <div class="slider-blocks" id="slider-blocks"></div>
              <div class="slider-range" id="slider-range"></div>
              <div class="slider-range slider-range-secondary" id="slider-range-secondary"></div>
              <div class="slider-handle" id="handle-start"></div>
              <div class="slider-handle" id="handle-end"></div>
            </div>
            <div class="slider-labels">
              <span>00</span>
              <span>06</span>
              <span>12</span>
              <span>18</span>
              <span>24</span>
            </div>

            <div class="schedule-block-list" id="schedule-block-list"></div>
          </div>
        </div>
      </section>
      <section id="settings" class="tab-content">
        <header>
          <div class="settings-header-row">
            <div class="settings-header-title">
              <h1>필터 설정</h1>
              <p>단순 필터(미디어/텍스트/딜레이/기타)를 원하는 강도로 조절해 보세요.</p>
            </div>
            <div class="settings-header-toggle">
              <span class="settings-header-toggle-label">인디케이터</span>
              <label class="switch">
                <input type="checkbox" id="settingsIndicatorToggle" />
                <span class="slider"></span>
              </label>
            </div>
          </div>
        </header>

        <div class="settings-layout-container">
          <div class="card settings-grid-pane settings-grid" id="settingsGrid"></div>

          <div class="settings-preview-pane settings-preview" id="settingsPreview">
            <div class="settings-preview-body">
              <div class="settings-preview-stage">
                <div class="preview-frame device-mockup">
                  <div class="device-mockup-top">
                    <div class="device-mockup-dots" aria-hidden="true">
                      <span class="device-dot device-dot-close"></span>
                      <span class="device-dot device-dot-min"></span>
                      <span class="device-dot device-dot-max"></span>
                    </div>
                    <div class="device-mockup-omnibox">
                      <span class="device-mockup-scheme" aria-hidden="true">momentum://</span>
                      <select class="device-mockup-site-select" data-preview-platform-select="true" aria-label="플랫폼 선택"></select>
                    </div>
                    <button type="button" class="device-mockup-variant-btn" data-preview-variant-toggle="true" aria-label="After/Before 전환">
                      <span class="settings-preview-mode-pill" data-preview-variant-label="true"></span>
                    </button>
                  </div>
                  <div class="device-mockup-viewport">
                    <div class="preview-layer" id="previewBefore"></div>
                    <div class="preview-layer" id="previewAfter"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section id="util" class="tab-content">
        <header>
          <h1>유틸</h1>
          <p>단순 필터를 넘어, 더 구체적이고 능동적인 교정 기능들을 모아둡니다.</p>
        </header>

        <div class="card util-setting-card" id="utilVideoSkipGuardCard" style="margin-bottom: 16px">
          <div class="util-setting-row">
            <div class="util-setting-text">
              <h3 style="margin: 0">비디오 스킵 제한</h3>
              <p class="util-setting-desc">영상에서 앞으로 점프하려면 스킵권이 필요하게 됩니다. 스킵권은 시간에 따라 충전됩니다.</p>
            </div>
            <div class="util-setting-control">
              <label class="switch">
                <input type="checkbox" id="utilVideoSkipGuardToggle" />
                <span class="slider"></span>
              </label>
              <span class="util-setting-status" id="utilVideoSkipGuardStatus">OFF</span>
            </div>
          </div>
        </div>

        <div class="card" id="nudgeDebugPanel" style="margin-bottom: 16px">
          <div class="settings-preview-header" style="margin-bottom: 10px">
            <div class="settings-preview-title">
              <h3 style="margin: 0">게임(개입) 테스트</h3>
              <p style="margin: 6px 0 0; color: var(--text-muted); font-size: 13px">
                활성 탭(최근 사용 탭)에 스폰하여 움직임을 확인하고 튜닝합니다.
              </p>
            </div>
          </div>

          <h4 class="nudge-section-title">자동 개입(누적시간)</h4>
          <p class="nudge-section-desc">차단 사이트 누적 시간이 기준을 넘으면 자동으로 스폰됩니다. 기본값은 OFF입니다.</p>
          <div class="nudge-debug-grid">
            <label class="nudge-debug-row">
              <span class="nudge-debug-label">사용</span>
              <label class="switch" style="justify-self: start">
                <input id="nudgeAutoToggle" type="checkbox" />
                <span class="slider"></span>
              </label>
              <output id="nudgeAutoToggleOutput" class="nudge-debug-output">OFF</output>
            </label>
            <label class="nudge-debug-row">
              <span class="nudge-debug-label">기준</span>
              <input id="nudgeAutoThresholdRange" type="range" min="5" max="240" step="5" value="30" />
              <output id="nudgeAutoThresholdOutput" class="nudge-debug-output">30분</output>
            </label>
          </div>

          <hr class="nudge-divider" />
          <h4 class="nudge-section-title">수동 테스트</h4>

          <div class="nudge-debug-grid">
            <label class="nudge-debug-row">
              <span class="nudge-debug-label">크기</span>
              <input id="nudgeSizeRange" type="range" min="32" max="220" step="2" value="96" />
              <output id="nudgeSizeOutput" class="nudge-debug-output">96px</output>
            </label>
            <label class="nudge-debug-row">
              <span class="nudge-debug-label">속도</span>
              <input id="nudgeSpeedRange" type="range" min="30" max="600" step="10" value="140" />
              <output id="nudgeSpeedOutput" class="nudge-debug-output">140</output>
            </label>
            <label class="nudge-debug-row">
              <span class="nudge-debug-label">스폰 간격</span>
              <input id="nudgeSpawnIntervalRange" type="range" min="300" max="10000" step="100" value="4000" />
              <output id="nudgeSpawnIntervalOutput" class="nudge-debug-output">4000ms</output>
            </label>
            <label class="nudge-debug-row">
              <span class="nudge-debug-label">최대 개수</span>
              <input id="nudgeMaxSpritesRange" type="range" min="1" max="20" step="1" value="6" />
              <output id="nudgeMaxSpritesOutput" class="nudge-debug-output">6</output>
            </label>
            <label class="nudge-debug-row">
              <span class="nudge-debug-label">가속(배율)</span>
              <input id="nudgeSpeedRampRange" type="range" min="1" max="2" step="0.05" value="1.15" />
              <output id="nudgeSpeedRampOutput" class="nudge-debug-output">1.15x</output>
            </label>
          </div>

          <div class="nudge-debug-actions">
            <button id="nudgeSpawnBtn" class="primary-btn" type="button">스폰</button>
            <button id="nudgeStopBtn" class="primary-btn nudge-debug-stop" type="button">정지</button>
            <button id="resetStatsBtn" class="primary-btn nudge-debug-stop" type="button">테스트: 통계 초기화</button>
            <span id="nudgeDebugStatus" class="nudge-debug-status"></span>
          </div>
        </div>
      </section>

          </div>

    <script src="../entries/dashboard/index.js" type="module"></script>
  </body>
</html>
