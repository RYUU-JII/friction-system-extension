background.js

1. 탭을 순회하여 누적 사용시간을 처리하는 로직

기존엔 개별 탭에 대해 로컬 저장소로부터 데이터를 불러와 수정하고 저장하는 것을 반복함
get, set 동기화 오류로 누적이 제대로 반영되지 않고 이전 데이터에 계속 덮어씌우는 문제 발생
배치처리로 한 번 불러와 전부 처리하고 한번에 넣는 방식으로 문제 해결


2. 클릭지연 로직
window.location.href로 클릭지연을 구현했지만, 안 먹는 상호작용이 많았음
-> .click()을 재생성하는 방식은 재귀오류에 빠질 가능성이 있었지만 bypass 플래그를 도입해
시스템이 생성한 클릭은 가로채지 않도록 함

인라인 스크립트로 간주되어 명령이 차단됨
-> 상태기반 CSS 클래스 태그를 삽입한 뒤 임의변경이 아닌 상태변환을 통해 상호작용


3. Service Worker 휘발성 문제 수정
기존 background.js에서 let isScheduleActiveCache = true; 같은 전역변수로 상태관리
MV3의 서비스워커는 유휴상태에 종료됨 -> 브라우저가 깨우면 전역변수 초기화
isScheduleActiveCache가 초기화되어 불필요한 업데이트 전파 가능성
상태값은 chrome.storage.session 혹은 chrome.storage.local에 저장해야함

4. 통계트래커 I/O 비효율성
setInterval -> chrome.alarms로 안정성 올림
10초 단위로 실행되 모든 탭 순회하며 storage.local.set을 반복호출
-> 데이터를 메모리에서 취합한 뒤 한 번의 set호출로 일괄저장

5. Storage 부하
하이브리드 캐싱
1분 주기의 계산은 메모리에서만 이뤄지게 함
실제 디스크 쓰기는 탭 전환/로드 시와 10분 주기로 수행

6. 즉시저장 로직 개선
탭 전환 등의 이벤트에서 지속적으로 즉시저장을 한다면 경우에 따라 비효율적
탭 전환시 즉시저장을 없애고 10분 주기 + 서비스워커 종료시 저장에 관리페이지 접속시 즉시저장

7. 비동기
storage작업은 async(비동기)로 돌림

8. 즉시저장 및 디바운싱
I/O 폭주를 막기 위한 로직이 불필요해 제거하고 변화가 있을 시 즉시저장
대신 짧은 시간안에 너무 많은 저장이 발생하는 시나리오를 방지하기 위해 디바운싱 로직 추가

9. 대시보드 동기화
대시보드가 로드될 때 로컬 저장소로부터 갱신

10. 셔플 필터
기존 전체 재스캔 -> 새로 추가된 노드만 감시해 적용

--------------------------------------------------------------------
추후 수정예정

-> overview 탭에 일일 리캡이 초기화되지 않는 현상
-> detailed recap 탭에 overview를 통합하는 방안 고려
	ㄴ 시간대 클릭 시 해당 시간대의 세부 이용내역

-> 초기 강한필터, 이후 조금 약해졌다 다시 점진적으로 강해짐
	ㄴ 혹은 초기 약한 필터
	ㄴ 시간이 목표치를 초과해 누적될수록 다음 진입시 초기 필터가 강해지고, 이후 추가로 필터가 강해지는 주기가 짧아짐

-> 버튼 등에 호버시 설명 추가
-> 일부 기능은 (?) 버튼으로 설명 오버레이
